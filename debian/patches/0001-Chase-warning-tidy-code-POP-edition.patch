From 15cb75b49e93b6566ca8437e417aaa6e0d910e37 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D0=BD=D0=B0=D0=B1?= <nabijaczleweli@nabijaczleweli.xyz>
Date: Sat, 8 Apr 2023 12:26:39 +0200
Subject: [PATCH 1/3] Chase warning, tidy code, POP edition
X-Mutt-PGP: OS

Port of c3d49a70b37f3702c52fef511943963da0e13c10, same code

Closes: #3810
---
 pop/pop.c | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/pop/pop.c b/pop/pop.c
index c3e0e9af0..ad147a28e 100644
--- a/pop/pop.c
+++ b/pop/pop.c
@@ -1103,11 +1103,9 @@ static bool pop_msg_open(struct Mailbox *m, struct Message *msg, int msgno)
   e->edata_free = pop_edata_free;
 
   e->lines = 0;
-  fgets(buf, sizeof(buf), msg->fp);
-  while (!feof(msg->fp))
+  while (fgets(buf, sizeof(buf), msg->fp) && !feof(msg->fp))
   {
     m->emails[msgno]->lines++;
-    fgets(buf, sizeof(buf), msg->fp);
   }
 
   e->body->length = ftello(msg->fp) - e->body->offset;
-- 
2.30.2

