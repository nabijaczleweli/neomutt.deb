From 27f74c110fec562ad526f94d43eb9d2877a7ae84 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D0=BD=D0=B0=D0=B1?= <nabijaczleweli@nabijaczleweli.xyz>
Date: Sat, 8 Apr 2023 12:37:44 +0200
Subject: [PATCH 3/3] send: search_attach_keyword(): check line iff it was read
X-Mutt-PGP: OS

Closes: #3810
---
 send/send.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/send/send.c b/send/send.c
index 438ef71f3..005d7e248 100644
--- a/send/send.c
+++ b/send/send.c
@@ -1732,9 +1732,8 @@ static bool search_attach_keyword(char *filename, struct ConfigSubset *sub)
 
   char *inputline = mutt_mem_malloc(1024);
   bool found = false;
-  while (!feof(fp_att))
+  while (!feof(fp_att) && fgets(inputline, 1024, fp_att))
   {
-    fgets(inputline, 1024, fp_att);
     if (!mutt_is_quote_line(inputline, NULL) &&
         mutt_regex_match(c_abort_noattach_regex, inputline))
     {
-- 
2.30.2

