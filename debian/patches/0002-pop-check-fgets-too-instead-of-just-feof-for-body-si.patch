From be061863cb5c4eebc4946c34eefbd6a014748a21 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D0=BD=D0=B0=D0=B1?= <nabijaczleweli@nabijaczleweli.xyz>
Date: Sat, 8 Apr 2023 12:35:18 +0200
Subject: [PATCH 2/3] pop: check fgets() too instead of just feof() for body
 size detection
X-Mutt-PGP: OS

Closes: #3810
---
 pop/pop.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/pop/pop.c b/pop/pop.c
index ad147a28e..807eb2832 100644
--- a/pop/pop.c
+++ b/pop/pop.c
@@ -169,7 +169,8 @@ static int pop_read_header(struct PopAccountData *adata, struct Email *e)
       while (!feof(fp))
       {
         e->body->length--;
-        fgets(buf, sizeof(buf), fp);
+        if(!fgets(buf, sizeof(buf), fp))
+          break;
       }
       break;
     }
-- 
2.30.2

